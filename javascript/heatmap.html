<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://cdn.plot.ly/plotly-2.35.2.min.js" charset="utf-8"></script>
        <script src="https://cdn.jsdelivr.net/npm/danfojs@1.1.2/lib/bundle.min.js"></script>
    <title>Heatmap chart</title>
</head>

<body>

    <div id="plot_div"></div>
    <script>
        const main = async () => {
            const df = await new dfd.readCSV("https://raw.githubusercontent.com/iijlab/data-visualization/refs/heads/main/data/weather.csv")
            df.head().print()

            const years = df["year"].values
            const cols = ["tokyo_mean", "tokyo_high", "tokyo_low", "sapporo_mean", "sapporo_high", "sapporo_low", "naha_mean", "naha_high", "naha_low"]
            const min = Math.min(...cols.map(val => df[val].min()))
            const max = Math.max(...cols.map(val => df[val].max()))

            const traceLow = {
                z: df.values.map(row=>[row[4], row[7], row[10]]),
                x: ["Tokyo Low", "Sapporo Low", "Naha Low"],
                type: "heatmap",
                xaxis: "x1",
                yaxis: "y1",
                legendgroup: "low",
                coloraxis: "coloraxis",
                zmin: min,
                zmax: max
            }
            
            const traceMean = {
                z: df.values.map(row=>[row[2], row[5], row[8]]),
                x: ["Tokyo Mean", "Sapporo Mean", "Naha Mean"],
                type: "heatmap",
                xaxis: "x2",
                yaxis: "y2",
                legendgroup: "mean",
                coloraxis: "coloraxis",
                zmin: min,
                zmax: max
            }

            const traceHigh = {
                z: df.values.map(row=>[row[3], row[6], row[9]]),
                x: ["Tokyo High", "Sapporo High", "Naha High"],
                type: "heatmap",
                xaxis: "x3",
                yaxis: "y3",
                legendgroup: "high",
                coloraxis: "coloraxis",
                zmin: min,
                zmax: max
            }

            const tickvals = Array.from({length: years.length}, (_, i) => i).filter(i => i % 12 === 0)
            const ticktext = Array.from({length: years.length}, (_, i) => i % 12 === 0 ? years[i] : '').filter((text, i) => i % 12 === 0)

            const layout = {
                height: 1000,
                grid: {
                    rows: 1,
                    columns: 3,
                    pattern: "independent"
                },
                coloraxis: {
                    cmin: min,
                    cmax: max,
                    showscale: true
                },
                yaxis1: { 
                    tickvals: tickvals,
                    ticktext: ticktext,
                 },
                yaxis2: { 
                    tickvals: tickvals,
                    ticktext: ticktext,
                 },
                yaxis3: { 
                    tickvals: tickvals,
                    ticktext: ticktext,
                 },
            }

            Plotly.newPlot("plot_div", [traceLow, traceMean, traceHigh], layout)
        }
        main()
    </script>
</body>

</html>