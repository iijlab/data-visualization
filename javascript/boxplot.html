<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Meta tags for character set and viewport settings for responsive design -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Include Plotly.js for creating interactive charts -->
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js" charset="utf-8"></script>
    
    <!-- Include Danfo.js for handling and processing data (like pandas in Python) -->
    <script src="https://cdn.jsdelivr.net/npm/danfojs@1.1.2/lib/bundle.min.js"></script>
    
    <!-- Title of the webpage -->
    <title>Box Plot chart</title>
</head>

<body>
    <!-- A container div where the Plotly chart will be rendered -->
    <div id="plot_div"></div>

    <script>
        // Asynchronous function to fetch data and generate the box plot
        const main = async () => {
            // Fetch weather data from a CSV file hosted on GitHub using Danfo.js
            const df = await new dfd.readCSV("https://raw.githubusercontent.com/iijlab/data-visualization/refs/heads/main/data/weather.csv")
            
            // Print the first few rows of the dataset to the console for inspection
            df.head().print()

            // Define the trace for the 'Mean' temperature values for Tokyo, Sapporo, and Naha
            const traceMean = {
                // x-axis categories for each city (Tokyo, Sapporo, Naha)
                x: df["tokyo_mean"].values.map(_ => "Tokyo")
                    .concat(df["sapporo_mean"].values.map(_ => "Sapporo"))
                    .concat(df["naha_mean"].values.map(_ => "Naha")),
                
                // y-axis values for the mean temperatures across cities
                y: df["tokyo_mean"].values.concat(df["sapporo_mean"].values).concat(df["naha_mean"].values),
                
                // Type of plot (box plot)
                type: "box",
                
                // Name of the trace
                name: "Mean",
            }

            // Define the trace for the 'High' temperature values for Tokyo, Sapporo, and Naha
            const traceHigh = {
                x: df["tokyo_high"].values.map(_ => "Tokyo")
                    .concat(df["sapporo_high"].values.map(_ => "Sapporo"))
                    .concat(df["naha_high"].values.map(_ => "Naha")),
                y: df["tokyo_high"].values.concat(df["sapporo_high"].values).concat(df["naha_high"].values),
                type: "box",
                name: "High",
            }

            // Define the trace for the 'Low' temperature values for Tokyo, Sapporo, and Naha
            const traceLow = {
                x: df["tokyo_low"].values.map(_ => "Tokyo")
                    .concat(df["sapporo_low"].values.map(_ => "Sapporo"))
                    .concat(df["naha_low"].values.map(_ => "Naha")),
                y: df["tokyo_low"].values.concat(df["sapporo_low"].values).concat(df["naha_low"].values),
                type: "box",
                name: "Low",
            }

            // Layout configuration for the box plot (chart title and axis settings)
            const layout = {
                // Title for the chart
                title: "Distribution of Monthly Temperatures (1994 - 2024)",
                
                // Y-axis settings (title and removal of zero line)
                yaxis: {
                    title: "Temperature",
                    zeroline: false
                },
                
                // Group the box plots together for easier comparison
                boxmode: "group"
            }

            // Create the Plotly box plot using the defined traces and layout
            Plotly.newPlot("plot_div", [traceLow, traceMean, traceHigh], layout)
        }

        // Run the main function to generate the plot
        main()
    </script>
</body>

</html>
